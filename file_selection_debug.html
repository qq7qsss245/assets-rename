<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ–‡ä»¶é€‰æ‹©çŠ¶æ€åŒæ­¥é—®é¢˜è¯Šæ–­</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .section {
            margin-bottom: 30px;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .section h3 {
            margin-top: 0;
            color: #333;
        }
        .debug-info {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 4px;
            font-family: monospace;
            font-size: 12px;
            white-space: pre-wrap;
        }
        .problem {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
        }
        .solution {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
        }
        .critical {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #0056b3;
        }
        .status {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 3px;
            font-size: 11px;
            font-weight: bold;
        }
        .status.ok { background: #d4edda; color: #155724; }
        .status.error { background: #f8d7da; color: #721c24; }
        .status.warning { background: #fff3cd; color: #856404; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸª² æ–‡ä»¶é€‰æ‹©çŠ¶æ€åŒæ­¥é—®é¢˜è¯Šæ–­æŠ¥å‘Š</h1>
        
        <div class="section">
            <h3>é—®é¢˜æè¿°</h3>
            <p>ç”¨æˆ·åæ˜ ï¼šæ–‡ä»¶å·²æ‹–å…¥ä¸”é¢„è§ˆæ˜¾ç¤ºæ­£å¸¸ï¼Œä½†ç‚¹å‡»é‡å‘½åæ—¶æç¤º"æœªé€‰æ‹©æ–‡ä»¶"ã€‚</p>
        </div>

        <div class="section">
            <h3>ğŸ” é—®é¢˜æ ¹æºåˆ†æ</h3>
            
            <div class="critical">
                <h4>ğŸš¨ å‘ç°çš„å…³é”®é—®é¢˜ï¼šå˜é‡ä½œç”¨åŸŸä¸ä¸€è‡´</h4>
                <p>é€šè¿‡ä»£ç åˆ†æï¼Œæˆ‘å‘ç°äº†å¯¼è‡´çŠ¶æ€ä¸åŒæ­¥çš„æ ¹æœ¬åŸå› ï¼š</p>
                
                <div class="debug-info">
<strong>1. ui.js ä¸­çš„å˜é‡å£°æ˜ï¼ˆç¬¬7-8è¡Œï¼‰ï¼š</strong>
let selectedFiles = [];
let previewData = [];

<strong>2. æ‹–æ‹½å¤„ç†ä¸­çš„å˜é‡è®¾ç½®ï¼ˆç¬¬604è¡Œã€ç¬¬672è¡Œï¼‰ï¼š</strong>
selectedFiles = files;  // è®¾ç½®çš„æ˜¯å±€éƒ¨å˜é‡

<strong>3. é‡å‘½åæ£€æŸ¥ä¸­çš„å˜é‡è¯»å–ï¼ˆapp.js ç¬¬128è¡Œï¼‰ï¼š</strong>
const currentSelectedFiles = window.selectedFiles || [];

<strong>4. å…¨å±€å˜é‡å¯¼å‡ºï¼ˆui.js ç¬¬748-754è¡Œï¼‰ï¼š</strong>
window.selectedFiles = selectedFiles;  // å¯¼å‡ºçš„æ˜¯åˆå§‹çš„ç©ºæ•°ç»„
window.previewData = previewData;
</div>
            </div>

            <div class="problem">
                <h4>âš ï¸ å…·ä½“é—®é¢˜åˆ†æï¼š</h4>
                <ul>
                    <li><strong>å˜é‡ä½œç”¨åŸŸæ··ä¹±</strong>ï¼šui.js ä¸­å£°æ˜äº†å±€éƒ¨å˜é‡ selectedFilesï¼Œä½†é‡å‘½ååŠŸèƒ½æœŸæœ›çš„æ˜¯ window.selectedFiles</li>
                    <li><strong>èµ‹å€¼ç›®æ ‡é”™è¯¯</strong>ï¼šæ‹–æ‹½å’Œç‚¹å‡»é€‰æ‹©æ–‡ä»¶æ—¶ï¼Œèµ‹å€¼ç»™äº†å±€éƒ¨å˜é‡è€Œä¸æ˜¯å…¨å±€å˜é‡</li>
                    <li><strong>å¯¼å‡ºæ—¶æœºé”™è¯¯</strong>ï¼šå…¨å±€å˜é‡å¯¼å‡ºåœ¨æ–‡ä»¶åŠ è½½æ—¶æ‰§è¡Œï¼Œæ­¤æ—¶ selectedFiles è¿˜æ˜¯ç©ºæ•°ç»„</li>
                    <li><strong>é¢„è§ˆåŠŸèƒ½æ­£å¸¸</strong>ï¼šå› ä¸º PreviewManager.updatePreview() ç›´æ¥æ¥æ”¶æ–‡ä»¶å‚æ•°ï¼Œä¸ä¾èµ–å…¨å±€å˜é‡</li>
                </ul>
            </div>
        </div>

        <div class="section">
            <h3>ğŸ“Š æ•°æ®æµåˆ†æ</h3>
            <div class="debug-info">
<strong>å½“å‰é”™è¯¯çš„æ•°æ®æµï¼š</strong>
1. æ‹–æ‹½æ–‡ä»¶ â†’ selectedFiles = files (å±€éƒ¨å˜é‡)
2. è°ƒç”¨ updateFileListDisplay(files) â†’ previewManager.updatePreview(files)
3. é¢„è§ˆæ­£å¸¸æ˜¾ç¤ºï¼ˆå› ä¸ºç›´æ¥ä¼ é€’äº† files å‚æ•°ï¼‰
4. ç‚¹å‡»é‡å‘½å â†’ æ£€æŸ¥ window.selectedFilesï¼ˆä»ç„¶æ˜¯ç©ºæ•°ç»„ï¼‰
5. æç¤º"æœªé€‰æ‹©æ–‡ä»¶"

<strong>æ­£ç¡®çš„æ•°æ®æµåº”è¯¥æ˜¯ï¼š</strong>
1. æ‹–æ‹½æ–‡ä»¶ â†’ window.selectedFiles = files (å…¨å±€å˜é‡)
2. è°ƒç”¨ updateFileListDisplay(files) â†’ previewManager.updatePreview(files)
3. é¢„è§ˆæ­£å¸¸æ˜¾ç¤º
4. ç‚¹å‡»é‡å‘½å â†’ æ£€æŸ¥ window.selectedFilesï¼ˆåŒ…å«æ–‡ä»¶åˆ—è¡¨ï¼‰
5. é‡å‘½åæˆåŠŸæ‰§è¡Œ
</div>
        </div>

        <div class="section">
            <h3>ğŸ”§ è§£å†³æ–¹æ¡ˆ</h3>
            
            <div class="solution">
                <h4>âœ… æ¨èè§£å†³æ–¹æ¡ˆï¼šç»Ÿä¸€ä½¿ç”¨å…¨å±€å˜é‡</h4>
                <p>éœ€è¦ä¿®æ”¹ä»¥ä¸‹å‡ ä¸ªå…³é”®ä½ç½®ï¼š</p>
                
                <div class="debug-info">
<strong>1. ui.js ç¬¬604è¡Œï¼ˆç‚¹å‡»é€‰æ‹©æ–‡ä»¶ï¼‰ï¼š</strong>
- ä¿®æ”¹å‰ï¼šselectedFiles = files;
- ä¿®æ”¹åï¼šwindow.selectedFiles = files;

<strong>2. ui.js ç¬¬672è¡Œï¼ˆæ‹–æ‹½æ–‡ä»¶ï¼‰ï¼š</strong>
- ä¿®æ”¹å‰ï¼šselectedFiles = validFiles;
- ä¿®æ”¹åï¼šwindow.selectedFiles = validFiles;

<strong>3. ui.js ç¬¬50è¡Œï¼ˆPreviewManager.updatePreviewï¼‰ï¼š</strong>
- ä¿®æ”¹å‰ï¼šselectedFiles = files;
- ä¿®æ”¹åï¼šwindow.selectedFiles = files;

<strong>4. ui.js ç¬¬28è¡Œï¼ˆPreviewManager.showDropZoneï¼‰ï¼š</strong>
- ä¿®æ”¹å‰ï¼šselectedFiles = [];
- ä¿®æ”¹åï¼šwindow.selectedFiles = [];

<strong>5. ui.js ç¬¬165è¡Œï¼ˆPreviewManager.refreshPreviewï¼‰ï¼š</strong>
- ä¿®æ”¹å‰ï¼šif (selectedFiles.length === 0) return;
- ä¿®æ”¹åï¼šif (window.selectedFiles.length === 0) return;

<strong>6. ui.js ç¬¬168è¡Œã€ç¬¬175è¡Œï¼š</strong>
- ä¿®æ”¹å‰ï¼šthis.showLoadingState(selectedFiles);
- ä¿®æ”¹åï¼šthis.showLoadingState(window.selectedFiles);
</div>
            </div>
        </div>

        <div class="section">
            <h3>ğŸ¯ éªŒè¯æ­¥éª¤</h3>
            <p>ä¿®å¤åéœ€è¦éªŒè¯ä»¥ä¸‹åœºæ™¯ï¼š</p>
            <ol>
                <li>æ‹–æ‹½æ–‡ä»¶ â†’ æ£€æŸ¥ window.selectedFiles æ˜¯å¦æ­£ç¡®è®¾ç½®</li>
                <li>ç‚¹å‡»é€‰æ‹©æ–‡ä»¶ â†’ æ£€æŸ¥ window.selectedFiles æ˜¯å¦æ­£ç¡®è®¾ç½®</li>
                <li>é¢„è§ˆæ˜¾ç¤º â†’ ç¡®è®¤é¢„è§ˆåŠŸèƒ½ä»ç„¶æ­£å¸¸</li>
                <li>é‡å‘½åæ“ä½œ â†’ ç¡®è®¤ä¸å†æç¤º"æœªé€‰æ‹©æ–‡ä»¶"</li>
                <li>æ¸…ç©ºæ“ä½œ â†’ ç¡®è®¤ window.selectedFiles è¢«æ­£ç¡®æ¸…ç©º</li>
            </ol>
        </div>

        <div class="section">
            <h3>ğŸš€ å…¶ä»–å‘ç°çš„æ½œåœ¨é—®é¢˜</h3>
            
            <div class="problem">
                <h4>âš ï¸ æ¬¡è¦é—®é¢˜ï¼š</h4>
                <ul>
                    <li><strong>é‡å¤çš„å…¨å±€å˜é‡å¯¼å‡º</strong>ï¼šui.js ç¬¬748-754è¡Œæœ‰é‡å¤çš„å¯¼å‡ºä»£ç </li>
                    <li><strong>å˜é‡åˆå§‹åŒ–æ—¶æœº</strong>ï¼šapp.js ä¸­æœ‰é¢å¤–çš„å˜é‡åˆå§‹åŒ–é€»è¾‘ï¼Œå¯èƒ½é€ æˆæ··ä¹±</li>
                    <li><strong>å‡½æ•°è°ƒç”¨é“¾å¤æ‚</strong>ï¼šupdateFileListDisplay â†’ previewManager.updatePreview çš„è°ƒç”¨é“¾å¯ä»¥ç®€åŒ–</li>
                </ul>
            </div>
        </div>

        <div class="section">
            <h3>ğŸ“‹ ä¿®å¤ä¼˜å…ˆçº§</h3>
            <div class="critical">
                <h4>ğŸ”¥ é«˜ä¼˜å…ˆçº§ï¼ˆå¿…é¡»ä¿®å¤ï¼‰ï¼š</h4>
                <p>ç»Ÿä¸€æ‰€æœ‰æ–‡ä»¶é€‰æ‹©ç›¸å…³çš„å˜é‡èµ‹å€¼ï¼Œç¡®ä¿éƒ½ä½¿ç”¨ window.selectedFiles</p>
            </div>
            
            <div class="problem">
                <h4>âš ï¸ ä¸­ä¼˜å…ˆçº§ï¼ˆå»ºè®®ä¿®å¤ï¼‰ï¼š</h4>
                <p>æ¸…ç†é‡å¤çš„å¯¼å‡ºä»£ç å’Œåˆå§‹åŒ–é€»è¾‘</p>
            </div>
            
            <div class="solution">
                <h4>ğŸ’¡ ä½ä¼˜å…ˆçº§ï¼ˆä¼˜åŒ–å»ºè®®ï¼‰ï¼š</h4>
                <p>ç®€åŒ–å‡½æ•°è°ƒç”¨é“¾ï¼Œæé«˜ä»£ç å¯ç»´æŠ¤æ€§</p>
            </div>
        </div>

        <div class="section">
            <h3>ğŸ§ª æµ‹è¯•å»ºè®®</h3>
            <p>ä¿®å¤åå»ºè®®è¿›è¡Œä»¥ä¸‹æµ‹è¯•ï¼š</p>
            <div class="debug-info">
// åœ¨æµè§ˆå™¨æ§åˆ¶å°ä¸­è¿è¡Œä»¥ä¸‹æµ‹è¯•ä»£ç ï¼š

// æµ‹è¯•1ï¼šæ£€æŸ¥å…¨å±€å˜é‡åˆå§‹çŠ¶æ€
console.log('åˆå§‹çŠ¶æ€ - window.selectedFiles:', window.selectedFiles);

// æµ‹è¯•2ï¼šæ¨¡æ‹Ÿæ–‡ä»¶é€‰æ‹©åæ£€æŸ¥çŠ¶æ€
// ï¼ˆåœ¨æ‹–æ‹½æˆ–ç‚¹å‡»é€‰æ‹©æ–‡ä»¶åè¿è¡Œï¼‰
console.log('æ–‡ä»¶é€‰æ‹©å - window.selectedFiles:', window.selectedFiles);
console.log('æ–‡ä»¶æ•°é‡:', window.selectedFiles ? window.selectedFiles.length : 0);

// æµ‹è¯•3ï¼šæ£€æŸ¥é‡å‘½ååŠŸèƒ½æ˜¯å¦èƒ½æ­£ç¡®è¯»å–æ–‡ä»¶
// ï¼ˆåœ¨ç‚¹å‡»é‡å‘½åæŒ‰é’®å‰è¿è¡Œï¼‰
const files = window.selectedFiles || [];
console.log('é‡å‘½åæ£€æŸ¥ - æ–‡ä»¶æ•°é‡:', files.length);
console.log('æ˜¯å¦ä¼šæç¤ºæœªé€‰æ‹©æ–‡ä»¶:', files.length === 0);
</div>
        </div>
    </div>
</body>
</html>
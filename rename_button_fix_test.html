<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>é‡å‘½åæŒ‰é’®ä¿®å¤æµ‹è¯•</title>
  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <!-- Bootstrap Icons -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
  <!-- è‡ªå®šä¹‰æ ·å¼ -->
  <link rel="stylesheet" href="styles.css">
  <style>
    .test-section {
      margin: 20px 0;
      padding: 20px;
      border: 1px solid #dee2e6;
      border-radius: 8px;
      background: #f8f9fa;
    }
    .test-result {
      margin: 10px 0;
      padding: 10px;
      border-radius: 4px;
    }
    .test-pass {
      background: #d1edff;
      border: 1px solid #0ea5e9;
      color: #0369a1;
    }
    .test-fail {
      background: #fee2e2;
      border: 1px solid #ef4444;
      color: #dc2626;
    }
    .test-warning {
      background: #fef3c7;
      border: 1px solid #f59e0b;
      color: #d97706;
    }
    .console-output {
      background: #1e1e1e;
      color: #ffffff;
      padding: 15px;
      border-radius: 4px;
      font-family: 'Courier New', monospace;
      font-size: 12px;
      max-height: 300px;
      overflow-y: auto;
      margin: 10px 0;
    }
    .test-button {
      margin: 5px;
    }
  </style>
</head>
<body>
  <div class="container-fluid">
    <div class="row">
      <div class="col-md-8">
        <!-- ä¸»åº”ç”¨ç•Œé¢ -->
        <div class="main-container">
          <!-- é‡å‘½åå‚æ•°åŒºåŸŸ -->
          <div class="params-section">
            <h4><i class="bi bi-gear me-2"></i>é‡å‘½åå‚æ•°</h4>
            <div class="params-grid">
              <div class="param-group">
                <label for="product">äº§å“å <span class="text-danger">*</span></label>
                <input type="text" class="form-control" id="product" placeholder="è¯·è¾“å…¥äº§å“å" value="TestProduct">
              </div>
              
              <div class="param-group">
                <label for="template">æ¨¡æ¿å <span class="text-danger">*</span></label>
                <input type="text" class="form-control" id="template" placeholder="è¯·è¾“å…¥æ¨¡æ¿å" value="TestTemplate">
              </div>
              
              <div class="param-group">
                <label for="video">è§†é¢‘å <span class="text-danger">*</span></label>
                <input type="text" class="form-control" id="video" placeholder="è¯·è¾“å…¥è§†é¢‘å" value="TestVideo">
              </div>
              
              <div class="param-group">
                <label for="author">åˆ¶ä½œäºº <span class="text-danger">*</span></label>
                <input type="text" class="form-control" id="author" placeholder="è¯·è¾“å…¥åˆ¶ä½œäºº" value="TestAuthor">
              </div>
              
              <div class="param-group">
                <label for="duration">åˆ¶ä½œæ—¶é•¿ï¼ˆå°æ—¶ï¼‰ <span class="text-danger">*</span></label>
                <input type="number" class="form-control" id="duration" placeholder="1" min="0.1" step="0.1" value="2.5">
              </div>
              
              <div class="param-group">
                <label for="language">è¯­è¨€ï¼ˆå¯é€‰ï¼‰</label>
                <input type="text" class="form-control" id="language" placeholder="å¦‚ï¼šzhã€en" value="zh">
              </div>
            </div>
          </div>

          <!-- é¢„è§ˆåŒºåŸŸ -->
          <div class="preview-section">
            <div class="preview-header">
              <h5><i class="bi bi-eye me-2"></i>æ–‡ä»¶é¢„è§ˆ</h5>
            </div>
            <div class="preview-body">
              <div class="preview-content">
                <!-- æ‹–æ‹½åŒºåŸŸ -->
                <div id="drop-zone" class="drop-zone">
                  <div class="drop-zone-content">
                    <i class="bi bi-cloud-upload drop-zone-icon"></i>
                    <div class="drop-zone-text">æ‹–æ‹½è§†é¢‘æ–‡ä»¶åˆ°æ­¤å¤„</div>
                    <div class="drop-zone-hint">æˆ–ç‚¹å‡»æ­¤åŒºåŸŸé€‰æ‹©æ–‡ä»¶<br>æ”¯æŒæ ¼å¼ï¼šMP4ã€MOVã€AVIã€MKVã€FLVã€WMVã€WEBM</div>
                  </div>
                </div>
                
                <!-- é¢„è§ˆè¡¨æ ¼ -->
                <div id="preview-table" class="d-none">
                  <div class="preview-table-container">
                    <table class="table table-striped table-hover mb-0">
                      <thead class="table-dark">
                        <tr>
                          <th>åŸæ–‡ä»¶å</th>
                          <th>é¢„è§ˆæ–°æ–‡ä»¶å</th>
                        </tr>
                      </thead>
                      <tbody id="preview-table-body">
                      </tbody>
                    </table>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- æ“ä½œæŒ‰é’®åŒºåŸŸ -->
          <div class="actions-section">
            <div class="actions-buttons">
              <button type="button" class="btn btn-outline-secondary" id="clear-fields">
                <i class="bi bi-arrow-clockwise me-1"></i>æ¸…ç©ºå­—æ®µ
              </button>
              <button type="button" class="btn btn-warning" id="undo-rename" disabled title="æ²¡æœ‰å¯æ’¤å›çš„æ“ä½œ">
                <i class="bi bi-arrow-counterclockwise me-1"></i>æ’¤å›é‡å‘½å
              </button>
              <button type="button" class="btn btn-success" id="rename-files">
                <i class="bi bi-pencil-square me-1"></i>å¼€å§‹é‡å‘½å
              </button>
            </div>
          </div>
        </div>
      </div>
      
      <div class="col-md-4">
        <!-- æµ‹è¯•æ§åˆ¶é¢æ¿ -->
        <div class="test-section">
          <h4><i class="bi bi-bug me-2"></i>ä¿®å¤æµ‹è¯•é¢æ¿</h4>
          
          <div class="mb-3">
            <h6>æµ‹è¯•æ“ä½œ</h6>
            <button class="btn btn-primary btn-sm test-button" onclick="runAllTests()">
              <i class="bi bi-play-circle me-1"></i>è¿è¡Œæ‰€æœ‰æµ‹è¯•
            </button>
            <button class="btn btn-info btn-sm test-button" onclick="runDiagnostics()">
              <i class="bi bi-search me-1"></i>è¿è¡Œè¯Šæ–­
            </button>
            <button class="btn btn-warning btn-sm test-button" onclick="simulateFileSelection()">
              <i class="bi bi-file-earmark me-1"></i>æ¨¡æ‹Ÿæ–‡ä»¶é€‰æ‹©
            </button>
            <button class="btn btn-success btn-sm test-button" onclick="testRenameButton()">
              <i class="bi bi-gear me-1"></i>æµ‹è¯•é‡å‘½åæŒ‰é’®
            </button>
          </div>
          
          <div id="test-results">
            <h6>æµ‹è¯•ç»“æœ</h6>
            <div id="test-output">ç‚¹å‡»ä¸Šæ–¹æŒ‰é’®å¼€å§‹æµ‹è¯•...</div>
          </div>
          
          <div class="mt-3">
            <h6>æ§åˆ¶å°è¾“å‡º</h6>
            <div id="console-output" class="console-output">
              ç­‰å¾…æµ‹è¯•å¼€å§‹...
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Bootstrap JavaScript -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  
  <!-- æ¨¡å—åŒ–JavaScriptæ–‡ä»¶ -->
  <script src="utils.js"></script>
  <script src="history.js"></script>
  <script src="ui.js"></script>
  <script src="app.js"></script>
  
  <!-- è°ƒè¯•å·¥å…· -->
  <script src="main_app_debug.js"></script>
  
  <!-- æµ‹è¯•è„šæœ¬ -->
  <script>
    // é‡å†™console.logä»¥æ˜¾ç¤ºåœ¨é¡µé¢ä¸Š
    const originalConsoleLog = console.log;
    const originalConsoleError = console.error;
    const originalConsoleWarn = console.warn;
    
    const consoleOutput = document.getElementById('console-output');
    
    function addToConsole(message, type = 'log') {
      const timestamp = new Date().toLocaleTimeString();
      const color = type === 'error' ? '#ff6b6b' : 
                   type === 'warn' ? '#ffd93d' : 
                   type === 'success' ? '#51cf66' : '#74c0fc';
      
      consoleOutput.innerHTML += `<div style="color: ${color};">[${timestamp}] ${message}</div>`;
      consoleOutput.scrollTop = consoleOutput.scrollHeight;
    }
    
    console.log = function(...args) {
      originalConsoleLog.apply(console, args);
      addToConsole(args.join(' '), 'log');
    };
    
    console.error = function(...args) {
      originalConsoleError.apply(console, args);
      addToConsole(args.join(' '), 'error');
    };
    
    console.warn = function(...args) {
      originalConsoleWarn.apply(console, args);
      addToConsole(args.join(' '), 'warn');
    };
    
    // æµ‹è¯•å‡½æ•°
    function addTestResult(message, type = 'pass') {
      const testOutput = document.getElementById('test-output');
      const resultClass = type === 'pass' ? 'test-pass' : 
                         type === 'fail' ? 'test-fail' : 'test-warning';
      
      const icon = type === 'pass' ? 'âœ…' : 
                  type === 'fail' ? 'âŒ' : 'âš ï¸';
      
      testOutput.innerHTML += `<div class="test-result ${resultClass}">${icon} ${message}</div>`;
    }
    
    function clearTestResults() {
      document.getElementById('test-output').innerHTML = '';
      consoleOutput.innerHTML = '';
    }
    
    function runAllTests() {
      clearTestResults();
      addTestResult('å¼€å§‹è¿è¡Œæ‰€æœ‰æµ‹è¯•...', 'warning');
      
      // æµ‹è¯•1: æ£€æŸ¥DOMå…ƒç´ 
      const renameButton = document.getElementById('rename-files');
      if (renameButton) {
        addTestResult('DOMå…ƒç´ æ£€æŸ¥: é‡å‘½åæŒ‰é’®å­˜åœ¨', 'pass');
      } else {
        addTestResult('DOMå…ƒç´ æ£€æŸ¥: é‡å‘½åæŒ‰é’®ä¸å­˜åœ¨', 'fail');
      }
      
      // æµ‹è¯•2: æ£€æŸ¥FieldValidator
      if (typeof FieldValidator !== 'undefined') {
        addTestResult('ä¾èµ–æ£€æŸ¥: FieldValidator å·²å®šä¹‰', 'pass');
      } else {
        addTestResult('ä¾èµ–æ£€æŸ¥: FieldValidator æœªå®šä¹‰', 'fail');
      }
      
      // æµ‹è¯•3: æ£€æŸ¥å…¨å±€å˜é‡
      if (typeof window.selectedFiles !== 'undefined') {
        addTestResult(`å…¨å±€å˜é‡æ£€æŸ¥: selectedFiles å·²åˆå§‹åŒ– (${window.selectedFiles.length} ä¸ªæ–‡ä»¶)`, 'pass');
      } else {
        addTestResult('å…¨å±€å˜é‡æ£€æŸ¥: selectedFiles æœªåˆå§‹åŒ–', 'fail');
      }
      
      // æµ‹è¯•4: æ£€æŸ¥äº‹ä»¶ç›‘å¬å™¨
      if (renameButton) {
        try {
          const clickEvent = new MouseEvent('click', { bubbles: true, cancelable: true });
          // ä¸å®é™…è§¦å‘ï¼Œåªæ£€æŸ¥æ˜¯å¦ä¼šæŠ›å‡ºé”™è¯¯
          addTestResult('äº‹ä»¶ç›‘å¬å™¨æ£€æŸ¥: é‡å‘½åæŒ‰é’®å¯ä»¥æ¥æ”¶ç‚¹å‡»äº‹ä»¶', 'pass');
        } catch (error) {
          addTestResult('äº‹ä»¶ç›‘å¬å™¨æ£€æŸ¥: é‡å‘½åæŒ‰é’®äº‹ä»¶å¤„ç†å¼‚å¸¸', 'fail');
        }
      }
      
      // æµ‹è¯•5: æ£€æŸ¥electronAPIç¯å¢ƒå¤„ç†
      if (typeof window.electronAPI === 'undefined') {
        addTestResult('ç¯å¢ƒæ£€æŸ¥: æµè§ˆå™¨ç¯å¢ƒï¼ŒelectronAPI æœªå®šä¹‰ï¼ˆæ­£å¸¸ï¼‰', 'warning');
      } else {
        addTestResult('ç¯å¢ƒæ£€æŸ¥: Electronç¯å¢ƒï¼ŒelectronAPI å¯ç”¨', 'pass');
      }
      
      addTestResult('æ‰€æœ‰æµ‹è¯•å®Œæˆï¼', 'pass');
    }
    
    function simulateFileSelection() {
      addTestResult('æ¨¡æ‹Ÿæ–‡ä»¶é€‰æ‹©...', 'warning');
      
      // æ¨¡æ‹Ÿé€‰æ‹©æ–‡ä»¶
      window.selectedFiles = [
        'C:\\test\\video1.mp4',
        'C:\\test\\video2.mp4',
        'C:\\test\\video3.mp4'
      ];
      
      addTestResult(`å·²æ¨¡æ‹Ÿé€‰æ‹© ${window.selectedFiles.length} ä¸ªæ–‡ä»¶`, 'pass');
      console.log('æ¨¡æ‹Ÿé€‰æ‹©çš„æ–‡ä»¶:', window.selectedFiles);
    }
    
    function testRenameButton() {
      addTestResult('æµ‹è¯•é‡å‘½åæŒ‰é’®...', 'warning');
      
      const renameButton = document.getElementById('rename-files');
      if (!renameButton) {
        addTestResult('é‡å‘½åæŒ‰é’®ä¸å­˜åœ¨', 'fail');
        return;
      }
      
      // ç¡®ä¿æœ‰æ¨¡æ‹Ÿæ–‡ä»¶
      if (!window.selectedFiles || window.selectedFiles.length === 0) {
        simulateFileSelection();
      }
      
      try {
        // æ¨¡æ‹Ÿç‚¹å‡»
        const clickEvent = new MouseEvent('click', {
          bubbles: true,
          cancelable: true,
          view: window
        });
        
        renameButton.dispatchEvent(clickEvent);
        addTestResult('é‡å‘½åæŒ‰é’®ç‚¹å‡»äº‹ä»¶å·²è§¦å‘', 'pass');
        
      } catch (error) {
        addTestResult(`é‡å‘½åæŒ‰é’®æµ‹è¯•å¤±è´¥: ${error.message}`, 'fail');
      }
    }
    
    // é¡µé¢åŠ è½½å®Œæˆåçš„åˆå§‹åŒ–
    window.addEventListener('load', function() {
      addTestResult('é¡µé¢åŠ è½½å®Œæˆï¼Œæµ‹è¯•ç¯å¢ƒå°±ç»ª', 'pass');
      console.log('ğŸ§ª é‡å‘½åæŒ‰é’®ä¿®å¤æµ‹è¯•é¡µé¢å·²åŠ è½½');
      console.log('ğŸ“‹ å¯ç”¨æµ‹è¯•å‘½ä»¤:');
      console.log('  - runAllTests(): è¿è¡Œæ‰€æœ‰æµ‹è¯•');
      console.log('  - runDiagnostics(): è¿è¡Œè¯Šæ–­');
      console.log('  - simulateFileSelection(): æ¨¡æ‹Ÿæ–‡ä»¶é€‰æ‹©');
      console.log('  - testRenameButton(): æµ‹è¯•é‡å‘½åæŒ‰é’®');
    });
  </script>
</body>
</html>